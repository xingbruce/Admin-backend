# Railway Admin Backend — Diver Bank (lighter)

## What this is
A small Flask admin backend to manage your Supabase `users` and `notifications` tables.
Admin UI available at `/admin/login` and `/admin/dashboard`.

## Required environment variables (Railway -> Variables)
- SUPABASE_URL (e.g. https://xxxx.supabase.co)
- SUPABASE_KEY (anon/public key OR service_role key — service_role is more powerful but sensitive)
- ADMIN_USERNAME (default: admin)
- ADMIN_PASSWORD (default: admin)
- FLASK_SECRET (session secret)

**Do not commit .env to GitHub.**

## Database schema — run these in Supabase SQL editor BEFORE deploying
```sql
CREATE TABLE IF NOT EXISTS public.users (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  username text UNIQUE NOT NULL,
  password_hash text NOT NULL,
  balance numeric DEFAULT 0,
  broker text,
  is_frozen boolean DEFAULT false,
  created_at timestamptz DEFAULT now()
);

CREATE TABLE IF NOT EXISTS public.notifications (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id bigint REFERENCES public.users(id) ON DELETE CASCADE,
  message text NOT NULL,
  is_read boolean DEFAULT false,
  created_at timestamptz DEFAULT now()
);

GRANT SELECT, INSERT, UPDATE, DELETE ON public.users TO anon;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.notifications TO anon;
